---
title: 이미지 프로세싱 & 컴퓨터 시각화 3부
---

안녕하세요. 지난시간에 우리는 opencv를 사용하여 이미지를 불러들여왔고 실제로 display까지 해봤습니다. 하지만 마지막에 우리는 아직 풀지 못한 수수께기가 있죠.. 기억 못하시는 분들을 위해 다시 이미지를 가져와볼께요.

![strange_minions](/emerald/img/strange_minions.png "strange_minions")

우리가 알고있는 노랑이 미니언즈가 아닌 이상한 색깔이 더해졌네요... 무슨 일이 생긴걸까요? 자! 이번시간에는 컴퓨터가 이미지를 어떻게 인식하며 간단한 색깔이론에 대해 설명할까 해요. 지루함을 없애기 위해 최대한 불필요한 설명은 없앨꺼에요. 약속합니다!!

우리는 어렸을때 미술시간에 색깔의 3요소에 대해 공부한적이 있죠? 빨강이, 초록이, 파랑이 이렇게 RGB(Red, Green, Blue) 라고 하죠. 좀 더 고급적인 어휘를 사용하자면 **삼원색** 이라고 하겠네요. 저는 여기서 RGB를 사용할께요. 그렇습니다. 우리는 저 3가지 색깔을 이용해 모든 색깔을 만들어낼 수 있습니다. 

![rgb](/emerald/img/rgb.png "rgb")  

그림을 보시면 빨강이와 초록이를 섞으면 노랑이가 만들어지고 빨강이와 파랑이가 합쳐지면 보랑이가 만들어지겠네요. 물론 노랑이를 만들기 위해 빨강이와 초록이를 섞고 아.......주 미미하게 파랑이를 섞어도 노랑이처럼 보이겠지만 우리의 컴퓨터는 완전한 노랑이라고 하지 않을꺼에요. 왜냐구요? 우리가 보는 색깔과 컴퓨터가 인식하는 색깔의 개념 자체가 다르답니다.

우리는 눈으로 색깔을 구분할 수 있으며 또한 사물을 구분할 수 있습니다. 당연한 소리를 해도 이해해주세요. 저건 책상이다! 저건 사람이다! 저건 파란 지갑이다. 이렇게 우리는 그 사물을 보면 즉시 분석이 가능하죠. 하지만 컴퓨터는 그렇지가 않아요. 

우선 컴퓨터는 색깔을 어떻게 이해하는지 간략히 살펴볼께요. 이해를 돕기위해 아래와같이 코드를 돌려봅니다. (패키지는 이미 import했다고 가정합니다)

```python
img = cv2.imread("DATA/minions.png")
print(type(img))
print(img.shape)

<class 'numpy.ndarray'>
(878, 1456, 3)
```
미니언즈 사진을 img라는 변수에 저장하고 img의 타입과 크기를 살펴봅니다. img는 Numpy의 array 형태이며 크기는 878 * 1456 * 3입니다. 878은 사진의 가로(width)이며 1456은 사진의 세로(height)를 뜻합니다. 그럼 뒤에 3은 뭘까요?? 그렇습니다. 3은 바로 색상의 3요소를 뜻하는 RGB를 뜻합니다. 즉 img는 3겹으로 이루어진 3차원 array이며 하나의 겹은 하나의 색깔을 나타내죠. 3차원 array가 뭐냐구요? 너무 테크니컬한건 설명 안할꺼에요. 쉽게 생각해서 종이 3장을 겹쳐놓는다 상상하시면 됩니다^^ 이해를 돕기위해 제가 색종이 3장을 만들어봤습니다.

![color_layer](/emerald/img/color_layer.png "color_layer")  

그리고 또 중요한 사실이 하나 더 있습니다. 위에 사진에서 보듯 하나의 정사각형?을 1 pixel로 간주합시다. 그럼 모든 정사각형에는 특정한 값이 존재합니다. 0부터 255까지의 숫자중 하나가 들어가게 됩니다. 0에 가까울 수록 색깔의 강도는 약해지며 255에 가까워질수록 색깔의 강도는 강력해집니다. 예를들어 RGB 3개의 layer가 있는데 첫번째(Red) layer의 모든 값이 255이고 나머지(Green, Blue) layer의 값들은 모두 0이라 칩시다. 그럼 우리는 모든 부분이 빨간 도화지가 보일꺼에요. 

이건 단순히 예를 들기위함이에요. 다시 미니언즈 예로 돌아올께요. 우리의 img는 가로 878칸, 세로 1456칸인 3개의 레이어로 이루어졌겠군요? 맞습니다. 정확히 이해했어요. 하지만 아직 궁금증이 풀리지 않았습니다. 왜 우리의 미니언즈 색깔은 이상하게 나오는 걸까요? 이유는 의외로 간단합니다. 그건 바로 opencv에서 이미지를 불러들이는 포멧입니다. 우리는 **plt.imshow()** 를 이용하여 이미지를 보여줬습니다. **plt**는 matplotlib의 한 부분이며 RGB순서를 요구합니다. 그러나 opencv로 이미지를 불러들이면 RGB가 아닌 BGR형태로 불러와집니다. 

자! 이제 이유를 조금 알 것 같네요. 문제가 생기면 고쳐야겠죠? 노랑이 미니언즈로 복원시켜봅시다.


```python
img = cv2.imread("DATA/minions.png")
right_img = cv2.cvtColor(img, cv2.COLOR_BGR2RGB)
plt.imshow(right_img)
```
![not_strange_minions](/emerald/img/not_strange_minions.png "not_strange_minions")

두번째줄에 cvtColor라는 함수를 사용하여 우리는 색깔의 시스템을 바꿨네요. **cv2.COLOR_BGR2RGB**를 자세히 보면 COLOR를 BGR에서 RGB로 바꿔줘!! 이런 뜻이겠네요. 웃긴점은 여기서 숫자2가 사용된점인데 A에서 B로 바꿔달라고 할때 Change A to B라 하잖아요. 아마 영어발음이 to랑 two랑 비슷해서, 그리고 함수이름을 조금이라도 덜 장황하게 하기 위해 숫자2를 쓴거 같습니다. 여담이 길었네요. 
RGB형태로 바꿨기 때문에 우리는 이제 우리가 알던 미니언즈를 볼 수 있습니다. :)

RGB와 BGR모두 3차원 array형태입니다. 그럼 여기서 질문!! 흑백이미지는 어떤가요? 답은 너무 간단합니다. 칼라풀한 이미지를 흑백으로 불러오는 방법은 다음 두가지 방법이 존재합니다.

[1] 
```python
img = cv2.imread("DATA/minions.png", 0)
plt.imshow(img, cmap = 'gray')
```

[2]
```python
img = cv2.imread("DATA/minions.png")
gray = cv2.cvtColor(img, cv2.COLOR_BGR2GRAY)
plt.imshow(img, cmap = 'gray')
```
![gray_minion](/emerald/img/gray_minion.png "gray_minion")

첫번째는 **cv2.imread()** 함수를 사용할때 두번째 파라미터로 0을 집어넣으면 우리의 컴터는 알아서 흑백으로 바꿔줍니다. 두번째는 일단 칼라풀한 이미지로 불러오고 위에서 봤던 *cvtColor()* 함수를 이용해서 BGR을 GRAY로 바꿔주는 방법입니다. 결과는 동일하게 나옵니다. 근데 여기서 주목할 부분은 **plt.imshow()** 안에 cmap='gray'는 뭔가요? cv2로 불러들인 혹은 흑백으로 변경한 이미지는 matplotlib에서 아주 이상하게 출력됩니다. 이를 방지하기 위한 코드라고 보시면 됩니다.  
그럼 흑백이미지는 크기가 어떻게 출력될까요?

```python
print(gray.shape)
(878, 1456)
```
음? 2차원 array네요. 더이상 3차원 array가 아니네요. 여기서 결론을 지어볼께요. 흑백은 color channel이 존재하지 않으며 단순히 1장의 도화지에(2차원 배열) 0부터 255까지의 값들만 존재합니다. 0에 가까워질수록 까망이, 255에 가까워질수록 하양이가 되겠네요. gray의 일부분을 가져와볼께요.

```python
array([[255, 255, 255, ..., 255, 255, 254],
       [255, 255, 255, ..., 255, 255, 254],
       [254, 255, 255, ..., 255, 255, 254],
       ...,
       [249, 247, 244, ..., 176, 214, 236],
       [247, 245, 243, ..., 189, 217, 235],
       [245, 244, 242, ..., 202, 220, 235]], dtype=uint8)
```

매우 다양한 값들이 존재하네요. 자! 오늘은 여기까지에요. 지루한 부분이었을텐데 여기까지 읽어오신 분들에게 박수를 보냅니다. 이제부터 조금씩 재미있는 부분을 다뤄보려고 합니다. 여태껏 우리는 사진을 불러오기만 했지 사진을 가지고 무얼 하진 않았잖아요? 그럼 모두들 다음에 봐요!!



